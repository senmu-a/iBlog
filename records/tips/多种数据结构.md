---
title: 多种数据结构
date: 2024/01/25
author: senmu
---

## 一、普通数组与 `Set` 对比

### 1.1 普通数组的底层数据结构

普通数组是 JavaScript 中的基本数据结构，它底层的数据结构是动态调整的。

1. 密集数组：`[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]`，使用连续的内存块来存储数据。
2. 稀疏数组：`[1, , , , , , , , , 10]`，使用哈希表来存储数据。
3. 动态数组：`const arr = []; arr.push(1); arr.pop();` 等类似操作，会对数组进行扩容。

### 1.2 `Set` 底层数据结构

Set 底层数据结构是一个哈希表，它使用哈希表来存储数据。

### 1.3 关于普通数组与 `Set` 的疑问？

* 稀疏数组是通过哈希表来存储数据，那么使用 `includes` 方法时时间复杂度是多少？ 答：`O(n)`
* `Set` 中的 `has` 与 `includes` 类似，那么他的时间复杂度又是多少？ 答：`O(1)`
* 他们的原理是什么？为什么会有差异？
*   * 他们的处理原理不同，`includes` 方法是通过遍历数组来查找元素（即使是稀疏数组），而 `has` 方法是通过哈希表来查找元素。

### 1.4 关于 `Set` 中 has 方法的原理扩展

1. 计算哈希值。使用哈希函数计算目标值的哈希值。
2. 查找哈希桶。根据哈希值找到对应的哈希桶。
3. 检查哈希冲突。如果哈希桶中有多个值（由于冲突），则遍历链表或使用其他方法查找目标值。
4. 返回结果

### 1.5 总结

针对以上分析，那普通数组和 `Set` 的使用场景到底有什么区别？

| 特性               | 普通数组（Array）              | Set                            |
|--------------------|-----------------------------|--------------------------------|
| **有序性**         | 有序                          | 无序                          |
| **重复值**         | 允许重复值                    | 不允许重复值                  |
| **索引访问**       | 支持（`arr[0]`）              | 不支持                        |
| **查找操作**       | `includes`，时间复杂度 `O(n)` | `has`，平均时间复杂度 `O(1)`  |
| **动态长度**       | 支持                          | 支持                          |
| **底层实现**       | 密集数组或稀疏数组            | 哈希表                        |
| **适用场景**       | 有序数据、重复值、索引访问    | 唯一值、快速查找、集合运算（并集、交集等）    |

---

## 二、普通对象与 `Map` 对比

### 2.1 普通对象的底层数据结构

一般来说，普通对象采用哈希表来存储，并通过隐藏类和内联缓存来优化访问性能。但是遇到频繁变化属性时会调整为字典结构。

`Map` 采用强哈希表来存储，插入顺序可以保证。

默认普通对象和 `Map` 的键值都是强引用，`WeakMap` 是弱引用，允许被垃圾回收。

#### 什么是隐藏类？

隐藏类就是将具有相同结构的对象共享同一个类定义，减少内存占用。

比如：

```js
const obj1 = { a: 1, b: 2 }; // 隐藏类 C1
const obj2 = { a: 3, b: 4 }; // 共享隐藏类 C1（与 obj1 共享）

// ⚠️但是！！！以下例子无法共享隐藏类
const obj1 = { a: 1, b: 2 }; // 隐藏类 C1
const obj2 = { b: 3, a: 4 }; // 隐藏类 C2

```

#### 什么是内联缓存？

优化同一个对象的同一个属性的多次访问。通过缓存属性访问的结果，加速后续访问。

比如：

```js
const obj = { a: 1, b: 2 };
console.log(obj.a); // 首次访问，记录缓存
console.log(obj.a); // 使用缓存，加速访问
```

### 2.2 图表对比

| 特性               | 普通对象（Object）            | Map                            |
|--------------------|-----------------------------|--------------------------------|
| **键类型**         | 字符串或符号（Symbol）        | 任意值                          |
| **键的顺序**       | 键的插入顺序                  | 键的插入顺序                    |
| **键的遍历**       | 需要手动遍历（`Object.keys()`）| 自动遍历                        |

### 2.3 总结

如果需要简单的存储并且读取的话使用普通对象即可，如果是需要频繁